<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ShareAble.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:contactsViewModel="clr-namespace:ShareAble.ViewModel"
    xmlns:local="clr-namespace:ShareAble.Converters"
    xmlns:mct="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
    xmlns:model="clr-namespace:ShareAble.Model"
    x:DataType="contactsViewModel:ContactsViewModel"
    BackgroundColor="Black"
    Shell.NavBarIsVisible="False"
    Shell.PresentationMode="Animated">

    <Page.Behaviors>
        <mct:StatusBarBehavior StatusBarColor="Black" />
    </Page.Behaviors>

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:PermissionStatusToVisibilityConverter x:Key="PermissionStatusToVisibilityConverter" />
            <local:StringToBooleanConverter x:Key="StringToBooleanConverter" />
            <local:StringToDisableColorConverter x:Key="StringToDisableColorConverter" />
            <local:StringToDisableBorderConverter x:Key="StringToDisableBorderConverter" />
            <local:StringToDisableLabelConverter x:Key="StringToDisableLabelConverter" />
            <local:BoolToDisableConverter x:Key="BoolToDisableConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <RefreshView
        x:Name="refreshView"
        Command="{Binding GetUsersCommand}"
        CommandParameter="{x:Reference refreshView}">
        <ScrollView>


            <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">

                <!--  Text above the card  -->
                <Label
                    Grid.Row="0"
                    Margin="20,10,0,0"
                    FontAttributes="Bold"
                    FontSize="28"
                    HorizontalOptions="Start"
                    Text="Explore"
                    TextColor="White"
                    VerticalOptions="Start" />

                <Label
                    Grid.Row="1"
                    Margin="20,20,0,0"
                    FontSize="12"
                    HorizontalOptions="Start"
                    Text="CREATE YOUR CIRCLE"
                    TextColor="White"
                    VerticalOptions="Start" />

                <Border
                    Grid.Row="2"
                    Margin="20"
                    Padding="20"
                    BackgroundColor="#FFBAF5"
                    Stroke="#FFBAF5"
                    StrokeShape="RoundRectangle 20">

                    <Grid
                        BackgroundColor="#FFBAF5"
                        ColumnDefinitions="Auto,Auto"
                        RowDefinitions="Auto,Auto">

                        <Label
                            Grid.Row="0"
                            Margin="10,0,0,0"
                            FontAttributes="Bold"
                            Text="{Binding LocalUserProperty.Name, StringFormat='Name: {0}'}" />


                        <!--  Rounded plus button  -->
                        <Border
                            Grid.Row="1"
                            Grid.Column="0"
                            Margin="10,10,0,0"
                            Padding="0"
                            BackgroundColor="White"
                            HeightRequest="40"
                            HorizontalOptions="Start"
                            Stroke="Black"
                            StrokeShape="RoundRectangle 20"
                            WidthRequest="40">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding GoToPostsPageCommand}" />
                            </Border.GestureRecognizers>
                            <Label
                                FontSize="24"
                                HorizontalOptions="Center"
                                Text="+"
                                TextColor="Black"
                                VerticalOptions="Center" />

                        </Border>


                        <StackLayout
                            Grid.Row="1"
                            Grid.Column="1"
                            Orientation="Horizontal">
                            <Border
                                Margin="-10,10,0,0"
                                Padding="0"
                                BackgroundColor="Black"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 20"
                                WidthRequest="40">
                                <Image Aspect="AspectFit" Source="{Binding LocalUserProperty.ImageSource}" />
                            </Border>


                            <Border
                                Margin="-10,10,0,0"
                                Padding="0"
                                BackgroundColor="Black"
                                HeightRequest="40"
                                IsVisible="{Binding LocalUserProperty.HasPartner}"
                                StrokeShape="RoundRectangle 20"
                                WidthRequest="40">
                                <Image Aspect="AspectFit" Source="{Binding PartnerLocalUser.ImageSource}" />
                            </Border>

                        </StackLayout>
                    </Grid>

                </Border>
                <Label
                    Grid.Row="3"
                    Margin="20,20,0,0"
                    FontSize="12"
                    HorizontalOptions="Start"
                    Text="CONTACTS"
                    TextColor="White"
                    VerticalOptions="Start" />

                <StackLayout Grid.Row="5" Margin="20">
                    <CollectionView
                        IsEnabled="{Binding LocalUserProperty.HasPartner, Converter={StaticResource BoolToDisableConverter}, ConverterParameter=ButtonBackground}"
                        ItemsSource="{Binding UsersCollection}"
                        SelectionMode="None">
                        <CollectionView.ItemsLayout>
                            <GridItemsLayout Orientation="Vertical" Span="2" />
                        </CollectionView.ItemsLayout>

                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="model:LocalUser">
                                <Grid
                                    Padding="5,0,5,0"
                                    ColumnDefinitions="Auto,Auto"
                                    RowDefinitions="Auto,Auto,Auto">
                                    <Border
                                        Margin="-5,17,10,7"
                                        BackgroundColor="#FFBAF5"
                                        HeightRequest="140"
                                        MaximumHeightRequest="210"
                                        MaximumWidthRequest="220"
                                        Stroke="#FFBAF5"
                                        StrokeShape="RoundRectangle 20"
                                        WidthRequest="180">

                                        <!--  Card content here  -->
                                        <Grid
                                            Margin="10,20,10,10"
                                            ColumnDefinitions="Auto,Auto"
                                            RowDefinitions="Auto,Auto,Auto"
                                            VerticalOptions="StartAndExpand">

                                            <!--  Image  -->
                                            <!--  Source="{Binding ImageSource}"  -->
                                            <Image
                                                Grid.Row="0"
                                                Grid.Column="0"
                                                Aspect="AspectFit"
                                                HeightRequest="50"
                                                HorizontalOptions="Start"
                                                Source="{Binding ImageSource}"
                                                VerticalOptions="Start"
                                                WidthRequest="50" />

                                            <!--  Rounded Add button  -->
                                            <Button
                                                Grid.Row="0"
                                                Grid.Column="1"
                                                Margin="10,0,2,0"
                                                BackgroundColor="{Binding HasPartner, Converter={StaticResource StringToDisableColorConverter}, ConverterParameter=ButtonBackground}"
                                                BorderColor="{Binding HasPartner, Converter={StaticResource StringToDisableColorConverter}, ConverterParameter=ButtonBackground}"
                                                BorderWidth="1"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type contactsViewModel:ContactsViewModel}}, Path=AddPartnerCommand}"
                                                CommandParameter="{Binding .}"
                                                CornerRadius="20"
                                                FontSize="18"
                                                HeightRequest="42"
                                                HorizontalOptions="End"
                                                IsEnabled="{Binding HasPartner, Converter={StaticResource BoolToDisableConverter}, ConverterParameter=ButtonBackground}"
                                                MaximumHeightRequest="20"
                                                MaximumWidthRequest="80"
                                                Text="Add"
                                                TextColor="Black"
                                                VerticalOptions="Start"
                                                WidthRequest="80" />
                                            <!--<Button
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        IsEnabled="{Binding HasPartner}"
                                        Margin="5,0,2,0"
                                        BackgroundColor="{Binding PartnerName, Converter={StaticResource StringToDisableColorConverter}, ConverterParameter=ButtonBackground}"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type contactsViewModel:ContactsViewModel}}, Path=AddPartnerCommand}"
                                        CommandParameter="{Binding .}"

                                        BorderColor="{Binding PartnerName, Converter={StaticResource StringToDisableBorderConverter}, ConverterParameter=ButtonBackground}"
                                        BorderWidth="1"
                                        CornerRadius="20"
                                        HeightRequest="20"
                                        HorizontalOptions="End"
                                        MaximumHeightRequest="20"
                                        Text="Add"
                                        TextColor="{Binding PartnerName, Converter={StaticResource StringToDisableLabelConverter}, ConverterParameter=ButtonBackground}"
                                        VerticalOptions="Start"
                                        WidthRequest="90" />-->


                                            <!--<Label
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Margin="5,7,5,2"
                                        FontAttributes="Bold"
                                        Text="{Binding Name}"
                                        VerticalOptions="Start" />-->
                                            <Label
                                                Grid.Row="1"
                                                Grid.Column="0"
                                                Grid.ColumnSpan="2"
                                                Margin="10,15,0,0"
                                                FontAttributes="Bold"
                                                FontSize="15"
                                                HorizontalOptions="Start"
                                                VerticalOptions="Start"
                                                WidthRequest="110">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="💖" />
                                                        <Span Text="  " />
                                                        <Span FontAttributes="Bold" Text="{Binding Name}" />
                                                    </FormattedString>
                                                </Label.FormattedText>

                                            </Label>


                                            <!--<Label
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                        Margin="10,2,5,2"
                                        FontAttributes="Bold"
                                        VerticalOptions="Start">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="💖" />
                                                        <Span Text="  " />
                                                        <Span Text="{Binding Source={RelativeSource AncestorType={x:Type contactsViewModel:ContactsViewModel}}, Path=PartnerLocalUser.Name}" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>-->
                                        </Grid>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

            </Grid>

        </ScrollView>
    </RefreshView>


</ContentPage>
